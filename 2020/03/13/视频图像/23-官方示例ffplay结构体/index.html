<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客，记录生活"><title>23.官方示例ffplay结构体 | BugNull</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">23.官方示例ffplay结构体</h1><a id="logo" href="/.">BugNull</a><p class="description">纸上得来终觉浅，绝知此事要躬行</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">23.官方示例ffplay结构体</h1><div class="post-meta">2020-03-13<span> | </span><span class="category"><a href="/categories/视频图像/">视频图像</a></span><!--script(src='https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js', async)--><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">MyAVPacketList</span> &#123;</span><span class="comment">//Packet链表 不使用AVPacketList</span></span><br><span class="line">    AVPacket		pkt;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">MyAVPacketList</span>	*<span class="title">next</span>;</span></span><br><span class="line">    <span class="keyword">int</span>			serial;</span><br><span class="line">&#125; MyAVPacketList;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">PacketQueue</span> &#123;</span><span class="comment">//packet队列</span></span><br><span class="line">    MyAVPacketList	*first_pkt, *last_pkt;</span><br><span class="line">    <span class="keyword">int</span>		nb_packets;                 <span class="comment">// 包数量，也就是队列元素数量</span></span><br><span class="line">    <span class="keyword">int</span>		size;                       <span class="comment">// 队列所有元素的数据大小总和</span></span><br><span class="line">    <span class="keyword">int64_t</span>		duration;               <span class="comment">// 队列所有元素的数据播放持续时间</span></span><br><span class="line">    <span class="keyword">int</span>		abort_request;              <span class="comment">// 用户退出请求标志</span></span><br><span class="line">    <span class="keyword">int</span>		serial;                     <span class="comment">// 播放序列，所谓播放序列就是一段连续的播放动作，一个seek操作会启动一段新的播放序列</span></span><br><span class="line">    SDL_mutex	*mutex;                 <span class="comment">// 互斥量</span></span><br><span class="line">    SDL_cond	*cond;                  <span class="comment">// 条件变量 产生阻塞</span></span><br><span class="line">&#125; PacketQueue;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">FrameQueue</span> &#123;</span></span><br><span class="line">    Frame <span class="built_in">queue</span>[FRAME_QUEUE_SIZE];</span><br><span class="line">    <span class="keyword">int</span> rindex;                     <span class="comment">// 读索引。待播放时读取此帧进行播放，播放后此帧成为上一帧</span></span><br><span class="line">    <span class="keyword">int</span> windex;                     <span class="comment">// 写索引</span></span><br><span class="line">    <span class="keyword">int</span> size;                       <span class="comment">// 总帧数</span></span><br><span class="line">    <span class="keyword">int</span> max_size;                   <span class="comment">// 队列可存储最大帧数</span></span><br><span class="line">    <span class="keyword">int</span> keep_last;                  <span class="comment">// 是否保留已播放的最后一帧使能标志</span></span><br><span class="line">    <span class="keyword">int</span> rindex_shown;               <span class="comment">// 是否保留已播放的最后一帧实现手段</span></span><br><span class="line">    SDL_mutex *mutex;</span><br><span class="line">    SDL_cond *cond;</span><br><span class="line">    PacketQueue *pktq;              <span class="comment">// 指向对应的packet_queue</span></span><br><span class="line">&#125; FrameQueue;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">AudioParams</span> &#123;</span><span class="comment">//音频参数</span></span><br><span class="line">    <span class="keyword">int</span>			freq;                   <span class="comment">// 采样率</span></span><br><span class="line">    <span class="keyword">int</span>			channels;               <span class="comment">// 通道数</span></span><br><span class="line">    <span class="keyword">int64_t</span>		channel_layout;         <span class="comment">// 通道布局，比如2.1声道，5.1声道等</span></span><br><span class="line">    <span class="keyword">enum</span> AVSampleFormat	fmt;            <span class="comment">// 音频采样格式，比如AV_SAMPLE_FMT_S16表示为有符号16bit深度，交错排列模式。</span></span><br><span class="line">    <span class="keyword">int</span>			frame_size;             <span class="comment">// 一个采样单元占用的字节数（比如2通道时，则左右通道各采样一次合成一个采样单元）</span></span><br><span class="line">    <span class="keyword">int</span>			bytes_per_sec;          <span class="comment">// 一秒时间的字节数，比如采样率48Khz，2 channel，16bit，则一秒48000*2*16/8=192000</span></span><br><span class="line">&#125; AudioParams;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Clock</span> &#123;</span></span><br><span class="line">    <span class="comment">// 当前帧(待播放)显示时间戳，播放后，当前帧变成上一帧</span></span><br><span class="line">    <span class="keyword">double</span> pts;           <span class="comment">/* clock base */</span></span><br><span class="line">    <span class="comment">// 当前帧显示时间戳与当前系统时钟时间的差值</span></span><br><span class="line">    <span class="keyword">double</span> pts_drift;     <span class="comment">/* clock base minus time at which we updated the clock */</span></span><br><span class="line">    <span class="comment">// 当前时钟(如视频时钟)最后一次更新时间，也可称当前时钟时间</span></span><br><span class="line">    <span class="keyword">double</span> last_updated;</span><br><span class="line">    <span class="comment">// 时钟速度控制，用于控制播放速度</span></span><br><span class="line">    <span class="keyword">double</span> speed;</span><br><span class="line">    <span class="comment">// 播放序列，所谓播放序列就是一段连续的播放动作，一个seek操作会启动一段新的播放序列</span></span><br><span class="line">    <span class="keyword">int</span> serial;           <span class="comment">/* clock is based on a packet with this serial */</span></span><br><span class="line">    <span class="comment">// 暂停标志</span></span><br><span class="line">    <span class="keyword">int</span> paused;</span><br><span class="line">    <span class="comment">// 指向packet_serial</span></span><br><span class="line">    <span class="keyword">int</span> *queue_serial;    <span class="comment">/* pointer to the current packet queue serial, used for obsolete clock detection */</span></span><br><span class="line">&#125; Clock;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Frame</span> &#123;</span><span class="comment">//帧</span></span><br><span class="line">    AVFrame		*frame;         <span class="comment">// 指向数据帧</span></span><br><span class="line">    AVSubtitle	sub;            <span class="comment">// 用于字幕</span></span><br><span class="line">    <span class="keyword">int</span>		serial;             <span class="comment">// 帧序列，在seek的操作时serial会变化</span></span><br><span class="line">    <span class="keyword">double</span>		pts;            <span class="comment">// 时间戳，单位为秒</span></span><br><span class="line">    <span class="keyword">double</span>		duration;       <span class="comment">// 该帧持续时间，单位为秒</span></span><br><span class="line">    <span class="keyword">int64_t</span>		pos;            <span class="comment">// 该帧在输入文件中的字节位置</span></span><br><span class="line">    <span class="keyword">int</span>		width;              <span class="comment">// 图像宽度</span></span><br><span class="line">    <span class="keyword">int</span>		height;             <span class="comment">// 图像高读</span></span><br><span class="line">    <span class="keyword">int</span>		format;             <span class="comment">// 对于图像为(enum AVPixelFormat)，对于声音则为(enum AVSampleFormat)</span></span><br><span class="line">    AVRational	sar;            <span class="comment">// 图像的宽高比，如果未知或未指定则为0/1</span></span><br><span class="line">    <span class="keyword">int</span>		uploaded;           <span class="comment">// 用来记录该帧是否已经显示过？</span></span><br><span class="line">    <span class="keyword">int</span>		flip_v;             <span class="comment">// =1则旋转180， = 0则正常播放</span></span><br><span class="line">&#125; Frame;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Decoder</span> &#123;</span></span><br><span class="line">    AVPacket pkt;</span><br><span class="line">    PacketQueue	*<span class="built_in">queue</span>;         <span class="comment">// 数据包队列</span></span><br><span class="line">    AVCodecContext	*avctx;     <span class="comment">// 解码器上下文</span></span><br><span class="line">    <span class="keyword">int</span>		pkt_serial;         <span class="comment">// 包序列</span></span><br><span class="line">    <span class="keyword">int</span>		finished;           <span class="comment">// 0即解码器处于工作状态</span></span><br><span class="line">    <span class="keyword">int</span>		packet_pending;     <span class="comment">// 0即解码器处于异常状态，需要考虑重置解码器；1即解码器处于正常状态</span></span><br><span class="line">    SDL_cond	*empty_queue_cond;  <span class="comment">// 检查到packet队列空时发送 signal缓存read_thread读取数据</span></span><br><span class="line">    <span class="keyword">int64_t</span>		start_pts;          <span class="comment">// 初始化时是stream的start time</span></span><br><span class="line">    AVRational	start_pts_tb;       <span class="comment">// 初始化时是stream的time_base</span></span><br><span class="line">    <span class="keyword">int64_t</span>		next_pts;           <span class="comment">// 记录最近一次解码后的frame的pts，当解出来的部分帧没有有效的pts时则使用next_pts进行推算</span></span><br><span class="line">    AVRational	next_pts_tb;        <span class="comment">// next_pts的单位</span></span><br><span class="line">    SDL_Thread	*decoder_tid;       <span class="comment">// 线程句柄</span></span><br><span class="line">&#125; Decoder;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">VideoState</span> &#123;</span></span><br><span class="line">    SDL_Thread *read_tid;           <span class="comment">// demux解复用线程</span></span><br><span class="line">    AVInputFormat *iformat;</span><br><span class="line">    <span class="keyword">int</span> abort_request;</span><br><span class="line">    <span class="keyword">int</span> force_refresh;</span><br><span class="line">    <span class="keyword">int</span> paused;</span><br><span class="line">    <span class="keyword">int</span> last_paused;</span><br><span class="line">    <span class="keyword">int</span> queue_attachments_req;</span><br><span class="line">    <span class="keyword">int</span> seek_req;                   <span class="comment">// 标识一次SEEK请求</span></span><br><span class="line">    <span class="keyword">int</span> seek_flags;                 <span class="comment">// SEEK标志，诸如AVSEEK_FLAG_BYTE等</span></span><br><span class="line">    <span class="keyword">int64_t</span> seek_pos;               <span class="comment">// SEEK的目标位置(当前位置+增量)</span></span><br><span class="line">    <span class="keyword">int64_t</span> seek_rel;               <span class="comment">// 本次SEEK的位置增量</span></span><br><span class="line">    <span class="keyword">int</span> read_pause_return;</span><br><span class="line">    AVFormatContext *ic;</span><br><span class="line">    <span class="keyword">int</span> realtime;</span><br><span class="line"></span><br><span class="line">    Clock audclk;                   <span class="comment">// 音频时钟</span></span><br><span class="line">    Clock vidclk;                   <span class="comment">// 视频时钟</span></span><br><span class="line">    Clock extclk;                   <span class="comment">// 外部时钟</span></span><br><span class="line"></span><br><span class="line">    FrameQueue pictq;               <span class="comment">// 视频frame队列</span></span><br><span class="line">    FrameQueue subpq;               <span class="comment">// 字幕frame队列</span></span><br><span class="line">    FrameQueue sampq;               <span class="comment">// 音频frame队列</span></span><br><span class="line"></span><br><span class="line">    Decoder auddec;                 <span class="comment">// 音频解码器</span></span><br><span class="line">    Decoder viddec;                 <span class="comment">// 视频解码器</span></span><br><span class="line">    Decoder subdec;                 <span class="comment">// 字幕解码器</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> audio_stream;               <span class="comment">// 音频流索引</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> av_sync_type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> audio_clock;             <span class="comment">// 每个音频帧更新一下此值，以pts形式表示</span></span><br><span class="line">    <span class="keyword">int</span> audio_clock_serial;         <span class="comment">// 播放序列，seek可改变此值</span></span><br><span class="line">    <span class="keyword">double</span> audio_diff_cum; <span class="comment">/* used for AV difference average computation */</span></span><br><span class="line">    <span class="keyword">double</span> audio_diff_avg_coef;</span><br><span class="line">    <span class="keyword">double</span> audio_diff_threshold;</span><br><span class="line">    <span class="keyword">int</span> audio_diff_avg_count;</span><br><span class="line">    AVStream *audio_st;             <span class="comment">// 音频流</span></span><br><span class="line">    PacketQueue audioq;             <span class="comment">// 音频packet队列</span></span><br><span class="line">    <span class="keyword">int</span> audio_hw_buf_size;          <span class="comment">// SDL音频缓冲区大小(单位字节)</span></span><br><span class="line">    <span class="keyword">uint8_t</span> *audio_buf;             <span class="comment">// 指向待播放的一帧音频数据，指向的数据区将被拷入SDL音频缓冲区。若经过重采样则指向audio_buf1，否则指向frame中的音频</span></span><br><span class="line">    <span class="keyword">uint8_t</span> *audio_buf1;            <span class="comment">// 音频重采样的输出缓冲区</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> audio_buf_size; <span class="comment">/* in bytes */</span> <span class="comment">// 待播放的一帧音频数据(audio_buf指向)的大小</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> audio_buf1_size;   <span class="comment">// 申请到的音频缓冲区audio_buf1的实际尺寸</span></span><br><span class="line">    <span class="keyword">int</span> audio_buf_index; <span class="comment">/* in bytes */</span> <span class="comment">// 当前音频帧中已拷入SDL音频缓冲区的位置索引(指向第一个待拷贝字节)</span></span><br><span class="line">    <span class="keyword">int</span> audio_write_buf_size;       <span class="comment">// 当前音频帧中尚未拷入SDL音频缓冲区的数据量，audio_buf_size = audio_buf_index + audio_write_buf_size</span></span><br><span class="line">    <span class="keyword">int</span> audio_volume;               <span class="comment">// 音量</span></span><br><span class="line">    <span class="keyword">int</span> muted;                      <span class="comment">// 静音状态</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">AudioParams</span> <span class="title">audio_src</span>;</span>   <span class="comment">// 音频frame的参数</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> CONFIG_AVFILTER</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">AudioParams</span> <span class="title">audio_filter_src</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">AudioParams</span> <span class="title">audio_tgt</span>;</span>   <span class="comment">// SDL支持的音频参数，重采样转换：audio_src-&gt;audio_tgt</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SwrContext</span> *<span class="title">swr_ctx</span>;</span>     <span class="comment">// 音频重采样context</span></span><br><span class="line">    <span class="keyword">int</span> frame_drops_early;          <span class="comment">// 丢弃视频packet计数</span></span><br><span class="line">    <span class="keyword">int</span> frame_drops_late;           <span class="comment">// 丢弃视频frame计数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> ShowMode &#123;</span><br><span class="line">        SHOW_MODE_NONE = <span class="number">-1</span>, SHOW_MODE_VIDEO = <span class="number">0</span>, SHOW_MODE_WAVES, SHOW_MODE_RDFT, SHOW_MODE_NB</span><br><span class="line">    &#125; show_mode;</span><br><span class="line">    <span class="keyword">int16_t</span> sample_array[SAMPLE_ARRAY_SIZE];</span><br><span class="line">    <span class="keyword">int</span> sample_array_index;</span><br><span class="line">    <span class="keyword">int</span> last_i_start;</span><br><span class="line">    RDFTContext *rdft;</span><br><span class="line">    <span class="keyword">int</span> rdft_bits;</span><br><span class="line">    FFTSample *rdft_data;</span><br><span class="line">    <span class="keyword">int</span> xpos;</span><br><span class="line">    <span class="keyword">double</span> last_vis_time;</span><br><span class="line">    SDL_Texture *vis_texture;</span><br><span class="line">    SDL_Texture *sub_texture;</span><br><span class="line">    SDL_Texture *vid_texture;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> subtitle_stream;                <span class="comment">// 字幕流索引</span></span><br><span class="line">    AVStream *subtitle_st;              <span class="comment">// 字幕流</span></span><br><span class="line">    PacketQueue subtitleq;              <span class="comment">// 字幕packet队列</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> frame_timer;                 <span class="comment">// 记录最后一帧播放的时刻</span></span><br><span class="line">    <span class="keyword">double</span> frame_last_returned_time;</span><br><span class="line">    <span class="keyword">double</span> frame_last_filter_delay;</span><br><span class="line">    <span class="keyword">int</span> video_stream;</span><br><span class="line">    AVStream *video_st;                 <span class="comment">// 视频流</span></span><br><span class="line">    PacketQueue videoq;                 <span class="comment">// 视频队列</span></span><br><span class="line">    <span class="keyword">double</span> max_frame_duration;      <span class="comment">// maximum duration of a frame - above this, we consider the jump a timestamp discontinuity</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SwsContext</span> *<span class="title">img_convert_ctx</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SwsContext</span> *<span class="title">sub_convert_ctx</span>;</span></span><br><span class="line">    <span class="keyword">int</span> eof;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *filename;</span><br><span class="line">    <span class="keyword">int</span> width, height, xleft, ytop;</span><br><span class="line">    <span class="keyword">int</span> step;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> CONFIG_AVFILTER</span></span><br><span class="line">    <span class="keyword">int</span> vfilter_idx;</span><br><span class="line">    AVFilterContext *in_video_filter;   <span class="comment">// the first filter in the video chain</span></span><br><span class="line">    AVFilterContext *out_video_filter;  <span class="comment">// the last filter in the video chain</span></span><br><span class="line">    AVFilterContext *in_audio_filter;   <span class="comment">// the first filter in the audio chain</span></span><br><span class="line">    AVFilterContext *out_audio_filter;  <span class="comment">// the last filter in the audio chain</span></span><br><span class="line">    AVFilterGraph *agraph;              <span class="comment">// audio filter graph</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> last_video_stream, last_audio_stream, last_subtitle_stream;</span><br><span class="line"></span><br><span class="line">    SDL_cond *continue_read_thread;</span><br><span class="line">&#125; VideoState;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">TextureFormatEntry</span> &#123;</span><span class="comment">//sdl音频输出有限 需要重采样</span></span><br><span class="line">    <span class="keyword">enum</span> AVPixelFormat format;</span><br><span class="line">    <span class="keyword">int</span> texture_fmt;</span><br><span class="line">&#125; sdl_texture_format_map[] = &#123;</span><br><span class="line">    &#123; AV_PIX_FMT_RGB8,           SDL_PIXELFORMAT_RGB332 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_RGB444,         SDL_PIXELFORMAT_RGB444 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_RGB555,         SDL_PIXELFORMAT_RGB555 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_BGR555,         SDL_PIXELFORMAT_BGR555 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_RGB565,         SDL_PIXELFORMAT_RGB565 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_BGR565,         SDL_PIXELFORMAT_BGR565 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_RGB24,          SDL_PIXELFORMAT_RGB24 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_BGR24,          SDL_PIXELFORMAT_BGR24 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_0RGB32,         SDL_PIXELFORMAT_RGB888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_0BGR32,         SDL_PIXELFORMAT_BGR888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_NE(RGB0, <span class="number">0B</span>GR), SDL_PIXELFORMAT_RGBX8888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_NE(BGR0, <span class="number">0</span>RGB), SDL_PIXELFORMAT_BGRX8888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_RGB32,          SDL_PIXELFORMAT_ARGB8888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_RGB32_1,        SDL_PIXELFORMAT_RGBA8888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_BGR32,          SDL_PIXELFORMAT_ABGR8888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_BGR32_1,        SDL_PIXELFORMAT_BGRA8888 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_YUV420P,        SDL_PIXELFORMAT_IYUV &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_YUYV422,        SDL_PIXELFORMAT_YUY2 &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_UYVY422,        SDL_PIXELFORMAT_UYVY &#125;,</span><br><span class="line">    &#123; AV_PIX_FMT_NONE,           SDL_PIXELFORMAT_UNKNOWN &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;<span class="comment">//音视频同步方式枚举</span></span><br><span class="line">    AV_SYNC_AUDIO_MASTER,                   <span class="comment">// 以音频为基准</span></span><br><span class="line">    AV_SYNC_VIDEO_MASTER,                   <span class="comment">// 以视频为基准</span></span><br><span class="line">    AV_SYNC_EXTERNAL_CLOCK,                 <span class="comment">// 以外部时钟为基准，synchronize to an external clock */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>23.官方示例ffplay结构体</p><p><span>文章作者：</span>whppmy</p><p><span>发布时间：</span>2020-03-13</p><p><span>最后更新：</span>2022-08-29</p><p><span>原始链接：</span><a href="/2020/03/13/视频图像/23-官方示例ffplay结构体/">http://bugnull.com/2020/03/13/视频图像/23-官方示例ffplay结构体/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="http://bugnull.com/2020/03/13/视频图像/23-官方示例ffplay结构体/"></i></span></p><p><span>版权声明：</span>个人记录，没有获取同意时，禁止转载！！</p></div><br><div class="tags"><a href="/tags/FFmpeg"><i class="fa fa-tag">FFmpeg</i></a></div><div class="post-nav"><a class="pre" href="/2022/08/30/网络/微服务/">什么是微服务架构</a><a class="next" href="/2020/03/12/视频图像/22-音视频同步参考/">22.音视频同步参考</a></div><div class="recommended_posts"><h3>相关阅读</h3><li><a href="http://bugnull.com/2022/08/30/网络/1.计臬机网络基础/" target="_blank">计算机网络基础</a></li><li><a href="http://bugnull.com/2022/08/30/网络/微服务/" target="_blank">什么是微服务架构</a></li><li><a href="http://bugnull.com/2020/03/12/视频图像/22-音视频同步参考/" target="_blank">22.音视频同步参考</a></li><li><a href="http://bugnull.com/2020/01/03/视频图像/21-官方示例H264的QSV加速简析/" target="_blank">21.官方示例H264的QSV加速简析</a></li></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><!DOCTYPE html><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/QT/">QT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/无处安放/">无处安放</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/视频图像/">视频图像</a></li></ul></div><!-- [ {name:'/qt'} ],  [ {name:'/acm'} ], [ {name:'/about'} ], [ {name:'/archives'} ]--><!DOCTYPE html><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签/ALL /search/index.html http://bugnull.com/search/index.html</i></div><div class="tagcloud"><a class="tags-list-link" href="/tags/QT基础" title="QT基础" style="font-size :15px;">QT基础</a><a class="tags-list-link" href="/tags/QT库使用" title="QT库使用" style="font-size :15px;">QT库使用</a><a class="tags-list-link" href="/tags/QT编译" title="QT编译" style="font-size :15px;">QT编译</a><a class="tags-list-link" href="/tags/杂谈" title="杂谈" style="font-size :15px;">杂谈</a><a class="tags-list-link" href="/tags/Libary" title="Libary" style="font-size :15px;">Libary</a><a class="tags-list-link" href="/tags/网络知识" title="网络知识" style="font-size :15px;">网络知识</a><a class="tags-list-link" href="/tags/FFmpeg" title="FFmpeg" style="font-size :15px;">FFmpeg</a><a class="tags-list-link" href="/tags/C++基础" title="C++基础" style="font-size :15px;">C++基础</a><a class="tags-list-link" href="/tags/MySQL" title="MySQL" style="font-size :15px;">MySQL</a><a class="tags-list-link" href="/tags/Linux基础" title="Linux基础" style="font-size :15px;">Linux基础</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/08/31/无处安放/设计模式/">设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/TCL事务控制语言/">MySQL TCL事务控制语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/DQL数据查询语言/">MySQL DQL数据查询语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/DML数据操作语言/">MySQL DML数据操作语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/DDL数据定义语言/">MySQL DDL数据定义语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/数据库的概念/">MySQL数据库概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/视图/">MySQL视图</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/流程控制/">MySQL流量控制</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/存储过程和函数/">MySQL存储过程和函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/30/数据库/常用类型与约束/">MySQL常用类型与约束</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <div>Total<span id="busuanzi_container_site_pv"><span> </span><span id="busuanzi_value_site_pv"></span></span><span rel="nofollow">  hits, </span><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span></span><span rel="nofollow">  visitors.</span></div>© <a href="/." rel="nofollow">BugNull.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script></div></body></html>